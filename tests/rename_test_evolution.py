import src.evolution as evolution
import pytest


@pytest.fixture
def canvas_one():
    return "11100011101010010111001100110001011100100010110101001010001011111100001010010000010000011000110110010100100010101100100100010111010001010100111110111001000010010111110100111101001100011010000110110101011101010100110100110011111101000101010011101000011011101000011001001000111100100110011111001110001001000011111101001010011100010100011111101100011111001101110100001110100100101011000010111101011000110010010111011100100000010110101111011110010000110011000001000011110001010010010101110110001101100011111101100001110111101001111110011111001110101000101000010111100011111001000000110001001011010111101111110011110110101110010111011011010111100100000001010110001110010110000011000000111000101110101010110011111110100011001101110110110111000001111101011100000100111111110101101011101101001001101010110000100000011000001101001011011001010101000100010110000110110010000001000011111111101110100010110011101000110100011110110100100000110101101010101100101000001011111001101110111110001000010010101001001110101001011011010100110011100000001100111011100110100111101010010001001010000000010111000110"


@pytest.fixture
def simulation():
    return evolution.Simulation()


def test_self():
    assert True


def test_init():
    sim = evolution.Simulation()


def test_drop_worst(simulation):
    assert len(simulation.canvases) == 16
    simulation.drop_worst()
    assert len(simulation.canvases) == 12
    simulation.drop_worst()
    assert len(simulation.canvases) == 8
    simulation.drop_worst()
    assert len(simulation.canvases) == 4
    simulation.drop_worst()
    assert len(simulation.canvases) == 0


def test_sort_canvases_by_score(simulation):
    assert len(simulation.canvases) == 16
    simulation.sort_canvases_by_score()
    assert len(simulation.canvases) == 16

    scores = [canvas.score() for canvas in simulation.canvases]
    for a, b in zip(scores, scores[1:]):
        assert a <= b


def test_mutate_code(simulation, canvas_one):
    mutated = simulation.mutate_code(canvas_one, 0)
    assert mutated == canvas_one

    for j in range(1, 20):
        mutated = simulation.mutate_code(canvas_one, j)
        assert mutated != canvas_one
        assert sum(a != b for a, b in zip(mutated, canvas_one)) == j
